/**
 * デモ用サンプルドキュメント登録スクリプト
 *
 * 使い方:
 *   npx tsx scripts/seed-demo-documents.ts
 *
 * 前提:
 *   - 環境変数 NEXT_PUBLIC_SUPABASE_URL, NEXT_PUBLIC_SUPABASE_ANON_KEY が設定されていること
 *   - デモ用ユーザーが既にログイン済みであること（user_id を指定）
 */

import { createClient } from "@supabase/supabase-js";

const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL!;
const supabaseKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!;

const supabase = createClient(supabaseUrl, supabaseKey);

// デモ用ユーザーID（実際のユーザーIDに置き換えてください）
const DEMO_USER_ID = process.env.DEMO_USER_ID || "demo-user-id";

interface SampleDocument {
  title: string;
  category: string;
  raw_content: string;
  summary: string;
  tags: string[];
}

const sampleDocuments: SampleDocument[] = [
  // =====================
  // 仕様書カテゴリ（4件）
  // =====================
  {
    title: "DocuFlow API仕様書 v2.0",
    category: "仕様書",
    raw_content: `# DocuFlow API 仕様書 v2.0

## 概要
DocuFlow は、ドキュメントの自動要約・タグ付け・検索を提供する SaaS です。
本仕様書では、REST API のエンドポイントと認証方式について定義します。

## 認証
すべての API リクエストには Bearer トークンが必要です。
トークンは /auth/login エンドポイントで取得できます。

## エンドポイント一覧

### POST /api/documents
新規ドキュメントを作成します。

リクエストボディ:
- title (string, optional): ドキュメントタイトル
- category (string, optional): カテゴリ名
- raw_content (string, required): ドキュメント本文

レスポンス:
- 201 Created: 作成成功
- 400 Bad Request: バリデーションエラー
- 401 Unauthorized: 認証エラー

### GET /api/documents
ドキュメント一覧を取得します。

クエリパラメータ:
- q (string): 検索キーワード
- category (string): カテゴリでフィルタ
- limit (number): 取得件数上限
- offset (number): オフセット

### GET /api/documents/:id
指定IDのドキュメント詳細を取得します。

### PUT /api/documents/:id
ドキュメントを更新します。

### DELETE /api/documents/:id
ドキュメントを削除します（論理削除）。

## レート制限
- 認証ユーザー: 1000 リクエスト/時間
- 匿名ユーザー: 100 リクエスト/時間

## エラーコード
- 400: Bad Request
- 401: Unauthorized
- 403: Forbidden
- 404: Not Found
- 429: Too Many Requests
- 500: Internal Server Error`,
    summary:
      "DocuFlow REST API の仕様書。認証方式、主要エンドポイント（CRUD操作）、レート制限、エラーコードを定義。Bearer トークン認証を採用し、ドキュメントの作成・取得・更新・削除のAPIを提供する。",
    tags: ["API", "REST", "仕様書"],
  },
  {
    title: "ユーザー認証システム設計書",
    category: "仕様書",
    raw_content: `# ユーザー認証システム設計書

## 1. 目的
本設計書は、DocuFlow における認証・認可の仕組みを定義します。

## 2. 認証方式
Supabase Auth を採用し、以下の認証方式をサポートします：
- メール/パスワード認証
- パスワードリセット（メール送信）
- セッション管理（Cookie ベース）

## 3. セキュリティ要件

### 3.1 パスワードポリシー
- 最小8文字以上
- 英数字混合を推奨
- 過去3回分のパスワードは再利用不可

### 3.2 セッション管理
- セッション有効期限: 7日間
- アイドルタイムアウト: 24時間
- 同時ログイン: 許可（最大5デバイス）

### 3.3 ブルートフォース対策
- 5回連続失敗でアカウント一時ロック（15分）
- CAPTCHA 導入（将来対応）

## 4. 認可（Authorization）
Row Level Security (RLS) を使用し、以下のルールを適用：
- ユーザーは自分のドキュメントのみアクセス可能
- 共有リンクを持つドキュメントは誰でも閲覧可能
- 管理者は全データにアクセス可能

## 5. トークン設計
- Access Token: JWT形式、有効期限1時間
- Refresh Token: 有効期限7日間
- トークンの保存場所: httpOnly Cookie

## 6. 監査ログ
以下のイベントを activity_logs テーブルに記録：
- ログイン成功/失敗
- パスワード変更
- アカウント削除`,
    summary:
      "DocuFlowの認証・認可設計。Supabase Authを採用し、メール/パスワード認証とセッション管理を実装。RLSによるデータアクセス制御、ブルートフォース対策、監査ログ機能を含む。",
    tags: ["認証", "セキュリティ", "設計"],
  },
  {
    title: "データベース設計書 - テーブル定義",
    category: "仕様書",
    raw_content: `# データベース設計書

## 1. 概要
DocuFlow で使用する PostgreSQL データベースのスキーマ設計です。
Supabase 上で運用し、RLS（Row Level Security）を有効化しています。

## 2. テーブル一覧

### 2.1 documents
ドキュメント本体を保持するメインテーブル。

| カラム名 | 型 | 説明 |
|---------|-----|------|
| id | UUID | 主キー |
| user_id | UUID | 所有者 |
| title | TEXT | タイトル |
| category | TEXT | カテゴリ |
| raw_content | TEXT | 本文 |
| summary | TEXT | AI要約 |
| tags | TEXT[] | タグ配列 |
| embedding | VECTOR(1536) | 埋め込みベクトル |
| is_favorite | BOOLEAN | お気に入り |
| is_pinned | BOOLEAN | ピン留め |
| is_archived | BOOLEAN | アーカイブ |
| share_token | TEXT | 共有トークン |
| created_at | TIMESTAMPTZ | 作成日時 |

### 2.2 document_versions
バージョン履歴を保存。

### 2.3 activity_logs
ユーザーの操作履歴を保存。

### 2.4 document_comments
ドキュメントへのコメントを保存。

## 3. インデックス
- documents_user_id_created_at_idx
- documents_embedding_idx (IVFFlat)
- activity_logs_user_id_created_at_idx

## 4. RLSポリシー
各テーブルに対して、user_id = auth.uid() のポリシーを設定。`,
    summary:
      "DocuFlowのPostgreSQLスキーマ設計。documents、document_versions、activity_logs、document_commentsの4テーブルを定義。pgvectorによる埋め込みベクトル、RLSポリシー、各種インデックスを含む。",
    tags: ["データベース", "PostgreSQL", "スキーマ"],
  },
  {
    title: "フロントエンド コンポーネント設計",
    category: "仕様書",
    raw_content: `# フロントエンド コンポーネント設計

## 1. 技術スタック
- Next.js 15 (App Router)
- React 19
- TypeScript
- Tailwind CSS

## 2. ディレクトリ構成

app/
├── (auth)/          # 認証関連ページ
├── app/             # ダッシュボード
├── documents/[id]/  # ドキュメント詳細
├── new/             # 新規作成
├── settings/        # 設定
└── share/[token]/   # 共有ページ

components/
├── CommandPalette.tsx  # Cmd+K パレット
├── Logo.tsx            # ロゴコンポーネント
├── Toast.tsx           # 通知トースト
├── Skeleton.tsx        # ローディング
└── EmptyState.tsx      # 空状態表示

## 3. 主要コンポーネント

### Logo
- サイズバリエーション: sm / md / lg
- ホバーアニメーション付き
- タグラインの表示/非表示切替

### CommandPalette
- Cmd+K で起動
- ドキュメント検索
- クイックアクション

### Toast
- success / error / info / warning の4種類
- 自動消去（3秒）
- スタック表示対応

## 4. スタイルガイドライン
- カラー: Emerald をプライマリに
- 角丸: rounded-lg / rounded-2xl
- シャドウ: shadow-sm / shadow-md
- アニメーション: transition-all duration-200`,
    summary:
      "DocuFlowのフロントエンド設計。Next.js 15 + React 19 + TypeScript + Tailwind CSSを採用。App Routerによるページ構成、再利用可能なコンポーネント（CommandPalette、Toast等）、スタイルガイドラインを定義。",
    tags: ["フロントエンド", "React", "Next.js"],
  },

  // =====================
  // 議事録カテゴリ（4件）
  // =====================
  {
    title: "週次開発定例 2024/12/02",
    category: "議事録",
    raw_content: `# 週次開発定例 議事録

日時: 2024年12月2日（月）10:00-11:00
参加者: 田中（PM）、佐藤（エンジニア）、鈴木（デザイナー）

## 1. 前週の振り返り

### 完了タスク
- ベクトル検索機能の実装（佐藤）
- ダッシュボードUIの改善（鈴木）
- E2Eテストの追加（佐藤）

### 未完了タスク
- PWA対応（60%完了、今週中に完了予定）
- パフォーマンス最適化（次週に延期）

## 2. 今週のタスク

| 担当 | タスク | 期限 |
|------|--------|------|
| 佐藤 | RLS本番設定 | 12/4 |
| 佐藤 | Sentry導入 | 12/5 |
| 鈴木 | ランディングページ改善 | 12/6 |
| 田中 | ドキュメント整備 | 12/6 |

## 3. 課題・相談事項

### 課題1: AI要約の精度
- 長文ドキュメントで要約が不十分なケースあり
- 対策: プロンプトの改善、チャンク分割の検討

### 課題2: ファイルサイズ制限
- 現状10MBだが、ユーザーから「もっと大きいファイルを」という声
- 対策: 20MBに引き上げ、ただしパフォーマンス影響を検証

## 4. 次回予定
- 日時: 2024年12月9日（月）10:00-11:00
- アジェンダ: スプリントレビュー、来週の計画`,
    summary:
      "週次開発定例の議事録。ベクトル検索・UI改善・E2Eテストが完了。今週はRLS設定、Sentry導入、LP改善を予定。AI要約精度とファイルサイズ制限について課題を議論。",
    tags: ["議事録", "定例", "開発"],
  },
  {
    title: "プロダクトロードマップ策定会議",
    category: "議事録",
    raw_content: `# プロダクトロードマップ策定会議

日時: 2024年11月25日（月）14:00-16:00
参加者: 山田（CEO）、田中（PM）、佐藤（エンジニア）、高橋（マーケ）

## 1. 現状確認

### 主要KPI（11月時点）
- MAU: 150人
- ドキュメント作成数/月: 約500件
- AI要約利用率: 78%
- 有料転換率: 5%

### ユーザーフィードバック（上位3件）
1. チーム共有機能がほしい
2. Slack連携がほしい
3. モバイルアプリがほしい

## 2. ロードマップ案

### Q1 2025（1-3月）
- チームワークスペース機能
- 権限管理（閲覧者/編集者/管理者）
- Slack通知連携

### Q2 2025（4-6月）
- モバイルアプリ（React Native）
- オフライン対応強化
- AI機能拡張（質問応答）

### Q3 2025（7-9月）
- エンタープライズプラン
- SSO対応（SAML）
- 監査ログ強化

## 3. 優先順位の決定

投票の結果、以下の優先順位に決定：
1. チームワークスペース（8票）
2. Slack連携（6票）
3. モバイルアプリ（4票）

## 4. ネクストアクション
- 田中: チーム機能の要件定義（12/10まで）
- 佐藤: 技術調査（マルチテナント設計）
- 高橋: 競合分析レポート作成`,
    summary:
      "プロダクトロードマップ策定会議。現状KPI（MAU150人、AI利用率78%）を確認。Q1はチームワークスペースとSlack連携、Q2はモバイルアプリを予定。チーム機能を最優先に決定。",
    tags: ["ロードマップ", "戦略", "プロダクト"],
  },
  {
    title: "障害対応振り返り 2024/11/20",
    category: "議事録",
    raw_content: `# 障害対応振り返り（ポストモーテム）

発生日時: 2024年11月20日 15:30-16:45
影響時間: 約75分
影響範囲: 全ユーザー（ログイン不可）

## 1. 事象概要

### 発生事象
- 15:30頃からユーザーがログインできない状態が発生
- エラーメッセージ: "Authentication failed"
- Supabase Auth が 503 を返していた

### 原因
- Supabase のメンテナンス中に、Auth サービスが一時的に停止
- 事前告知メールを見落としていた

### 対応
- 15:45: 障害検知（ユーザーからの問い合わせ）
- 15:50: Supabase ステータスページを確認、メンテナンス中と判明
- 16:00: ユーザーに Twitter / ステータスページで告知
- 16:45: Supabase メンテナンス完了、サービス復旧

## 2. 再発防止策

| No | 施策 | 担当 | 期限 |
|----|------|------|------|
| 1 | Supabase メンテナンス通知を Slack に転送 | 佐藤 | 11/25 |
| 2 | 外形監視（UptimeRobot）の導入 | 佐藤 | 11/27 |
| 3 | 障害時の社内エスカレーションフロー策定 | 田中 | 11/30 |

## 3. 良かった点
- 障害検知から15分で原因特定できた
- ユーザーへの告知が比較的早かった

## 4. 改善点
- 障害検知が遅かった（ユーザー問い合わせが最初）
- 自動監視アラートがなかった`,
    summary:
      "11/20のログイン障害のポストモーテム。Supabaseメンテナンスによる約75分のサービス停止。再発防止として外形監視導入、Slack通知連携、エスカレーションフロー策定を決定。",
    tags: ["障害", "振り返り", "インシデント"],
  },
  {
    title: "デザインレビュー会議 - ダッシュボード改善",
    category: "議事録",
    raw_content: `# デザインレビュー会議

日時: 2024年11月18日（月）15:00-16:30
参加者: 鈴木（デザイナー）、佐藤（エンジニア）、田中（PM）

## 1. レビュー対象
ダッシュボード画面の UI 改善案

## 2. 現状の課題
- 情報が多すぎて見づらい
- 重要なアクションが目立たない
- モバイルでの操作性が悪い

## 3. 改善提案

### 3.1 サマリーカードの再設計
- Before: 6つのカードが横並び
- After: 4つに絞り、階層化
  - プライマリ: 総ドキュメント数（大きく表示）
  - セカンダリ: ピン・お気に入り・インサイト

### 3.2 検索バーの強調
- 幅を広げる（現状50% → 70%）
- プレースホルダーを具体的に
- 検索履歴のサジェスト追加

### 3.3 カードデザイン
- ホバー時のアニメーション追加
- タグのクリック可能化
- 文字数の省略表示を改善

## 4. 決定事項
- 提案3.1、3.2を採用
- 3.3は次フェーズで対応

## 5. スケジュール
- Figma 更新: 11/20
- 実装: 11/22-25
- QA: 11/26-27
- リリース: 11/28`,
    summary:
      "ダッシュボードUI改善のデザインレビュー。サマリーカードを6→4つに絞り階層化、検索バーの幅拡大・サジェスト追加を決定。11/28リリース予定。",
    tags: ["デザイン", "UI/UX", "レビュー"],
  },

  // =====================
  // 企画書カテゴリ（3件）
  // =====================
  {
    title: "チームワークスペース機能 企画書",
    category: "企画書",
    raw_content: `# チームワークスペース機能 企画書

## 1. 背景
現在の DocuFlow は個人利用を前提としているが、
ユーザーアンケートで「チームで使いたい」という要望が多数寄せられている。

## 2. 目的
- チームでのドキュメント共有・共同編集を可能にする
- 有料プランへの転換率を向上させる

## 3. 機能概要

### 3.1 ワークスペース
- 1つのワークスペースに複数ユーザーが所属
- ワークスペース内のドキュメントは全メンバーがアクセス可能
- 個人ドキュメントとワークスペースドキュメントを分離

### 3.2 権限管理
| ロール | 閲覧 | 編集 | 削除 | メンバー管理 |
|--------|------|------|------|--------------|
| オーナー | ○ | ○ | ○ | ○ |
| 管理者 | ○ | ○ | ○ | ○ |
| 編集者 | ○ | ○ | - | - |
| 閲覧者 | ○ | - | - | - |

### 3.3 招待フロー
1. オーナーが招待メールを送信
2. 招待された人がリンクをクリック
3. アカウント作成（未登録の場合）
4. ワークスペースに参加

## 4. 技術検討事項
- マルチテナント設計（テーブル分離 vs RLS）
- 招待トークンの有効期限管理
- 権限チェックのパフォーマンス

## 5. スケジュール
- 要件定義: 12月
- 設計: 1月
- 実装: 2月
- βテスト: 3月前半
- リリース: 3月後半

## 6. KPI
- ワークスペース作成数: 100/月
- チーム利用率: 20%
- 有料転換率: 10%（現状5%）`,
    summary:
      "チームワークスペース機能の企画書。複数ユーザーでのドキュメント共有、4段階の権限管理（オーナー/管理者/編集者/閲覧者）、招待フローを定義。3月リリース予定、有料転換率10%が目標。",
    tags: ["企画", "チーム", "新機能"],
  },
  {
    title: "AI質問応答機能 企画書",
    category: "企画書",
    raw_content: `# AI質問応答機能 企画書

## 1. 概要
蓄積されたドキュメントに対して、自然言語で質問すると
AI が関連する情報を検索・要約して回答する機能。

## 2. ユースケース

### ケース1: 過去の決定事項を確認
- 質問: 「認証方式は何を採用することになった？」
- 回答: 「2024/11/10の設計会議で、Supabase Authを採用することが決定しました。
  理由は...」（関連ドキュメントへのリンク付き）

### ケース2: プロジェクト横断検索
- 質問: 「API のレート制限について教えて」
- 回答: 「API仕様書によると、認証ユーザーは1000リクエスト/時間、
  匿名ユーザーは100リクエスト/時間です。」

## 3. 技術アーキテクチャ

### 3.1 検索フロー
1. ユーザーが質問を入力
2. 質問を埋め込みベクトルに変換
3. pgvector で類似ドキュメントを検索
4. 上位5件のドキュメントをコンテキストとしてLLMに渡す
5. LLM が回答を生成

### 3.2 使用技術
- 埋め込み: OpenAI text-embedding-3-small
- LLM: GPT-4 Turbo
- ベクトルDB: Supabase pgvector

## 4. UI/UX
- チャット形式のインターフェース
- 回答には参照元ドキュメントを表示
- フォローアップ質問が可能

## 5. 懸念事項
- LLM のコスト（GPT-4 は高額）
- ハルシネーション（誤情報生成）のリスク
- レスポンス時間（5秒以内を目標）

## 6. MVP スコープ
- シンプルな質問応答のみ
- 参照元の表示
- 1日あたりの質問回数制限（無料: 10回、有料: 100回）`,
    summary:
      "AI質問応答機能の企画書。蓄積ドキュメントに対して自然言語で質問し、pgvector検索 + GPT-4で回答を生成。チャットUIで参照元表示。コストとハルシネーション対策が課題。",
    tags: ["AI", "RAG", "新機能"],
  },
  {
    title: "モバイルアプリ開発 企画書",
    category: "企画書",
    raw_content: `# モバイルアプリ開発 企画書

## 1. 目的
- モバイルでの利用体験を向上
- プッシュ通知による engagement 向上
- 競合との差別化

## 2. 対象プラットフォーム
- iOS (iPhone/iPad)
- Android

## 3. 技術選定

### 候補比較
| 項目 | React Native | Flutter | ネイティブ |
|------|--------------|---------|------------|
| 開発速度 | ◎ | ○ | △ |
| パフォーマンス | ○ | ◎ | ◎ |
| 学習コスト | ◎ | △ | △ |
| コード共有 | ◎ | ○ | × |

### 結論
React Native を採用
- Web版と技術スタック（React）が共通
- 既存の知見を活用可能
- Expo を使って開発効率化

## 4. 機能スコープ

### MVP（v1.0）
- ドキュメント一覧・検索
- ドキュメント閲覧
- オフライン閲覧（キャッシュ）
- プッシュ通知（共有・コメント）

### v2.0
- ドキュメント作成・編集
- カメラでのスキャン・OCR
- 音声入力

## 5. スケジュール
- 技術検証: 1月
- MVP開発: 2-3月
- βテスト: 4月
- ストア申請・リリース: 5月

## 6. リソース
- エンジニア: 1名（佐藤）
- デザイナー: 0.5名（鈴木、兼任）

## 7. 予算
- Apple Developer Program: $99/年
- Google Play Console: $25（初回のみ）
- テスト端末: 10万円`,
    summary:
      "モバイルアプリ開発の企画書。React Native + Expoを採用し、iOS/Android両対応。MVP（v1.0）は一覧・検索・閲覧・オフライン・プッシュ通知。5月リリース予定。",
    tags: ["モバイル", "React Native", "企画"],
  },

  // =====================
  // 提案書カテゴリ（2件）
  // =====================
  {
    title: "インフラコスト最適化 提案書",
    category: "提案書",
    raw_content: `# インフラコスト最適化 提案書

## 1. 現状分析

### 月額コスト内訳（11月）
| サービス | 費用 | 備考 |
|----------|------|------|
| Vercel | $0 | Hobby プラン |
| Supabase | $0 | Free プラン |
| OpenAI | $45 | GPT-4.1-mini |
| ドメイン | $1.5 | 年間$18 |
| **合計** | **$46.5** | |

### 課題
- OpenAI のコストが全体の97%を占める
- ユーザー増加に伴い、コストが線形に増加する見込み

## 2. 最適化提案

### 提案1: キャッシュの導入
- 同一コンテンツの要約結果をキャッシュ
- 重複リクエストを削減
- 期待効果: 20-30%のコスト削減

### 提案2: モデルの使い分け
- 短いドキュメント: GPT-3.5 Turbo（安価）
- 長いドキュメント: GPT-4.1-mini（現状維持）
- 期待効果: 15-20%のコスト削減

### 提案3: バッチ処理
- リアルタイム要約をやめ、非同期処理に
- オフピーク時間帯にまとめて処理
- 期待効果: 10-15%のコスト削減（Batch API割引）

## 3. 優先順位
1. キャッシュ導入（効果大、実装容易）
2. モデル使い分け（効果中、実装中）
3. バッチ処理（効果小、UX影響あり）

## 4. 導入スケジュール
- 提案1: 12月中
- 提案2: 1月中
- 提案3: 検討継続

## 5. 期待効果
- 月額コスト: $46.5 → $30 (約35%削減)
- 年間節約額: 約$200`,
    summary:
      "インフラコスト最適化の提案。OpenAIが月額コストの97%（$45）を占める課題に対し、キャッシュ導入・モデル使い分け・バッチ処理の3施策を提案。年間約$200の削減を期待。",
    tags: ["インフラ", "コスト", "最適化"],
  },
  {
    title: "セキュリティ強化 提案書",
    category: "提案書",
    raw_content: `# セキュリティ強化 提案書

## 1. 背景
ユーザー数の増加に伴い、セキュリティリスクが高まっている。
エンタープライズ顧客の獲得に向けて、セキュリティ体制の強化が必要。

## 2. 現状のセキュリティ対策
- ✅ HTTPS 通信
- ✅ Supabase Auth による認証
- ✅ RLS によるデータアクセス制御
- ❌ 2要素認証
- ❌ 監査ログの可視化
- ❌ セキュリティヘッダーの完全対応

## 3. 強化提案

### 3.1 2要素認証（2FA）の導入
- TOTP（Google Authenticator 等）対応
- バックアップコードの発行
- 対象: 全ユーザー（オプション）、管理者（必須）

### 3.2 監査ログの強化
- 現状: activity_logs テーブルに保存
- 強化: 
  - IPアドレスの記録
  - User-Agent の記録
  - ダッシュボードでの可視化

### 3.3 セキュリティヘッダー
- Content-Security-Policy
- Permissions-Policy
- X-Content-Type-Options（実装済み）

### 3.4 脆弱性スキャン
- Dependabot（実装済み）
- npm audit の CI 組み込み（実装済み）
- 定期的な手動レビュー

## 4. 優先順位
1. セキュリティヘッダー（即座に対応可能）
2. 監査ログ強化（1週間）
3. 2FA（2週間）

## 5. 予算
- 追加コストなし（既存サービス内で対応可能）

## 6. 期待効果
- エンタープライズ顧客の獲得
- セキュリティインシデントのリスク低減
- ユーザーの信頼性向上`,
    summary:
      "セキュリティ強化の提案書。2要素認証、監査ログ強化、セキュリティヘッダー完全対応を提案。エンタープライズ顧客獲得に向けて、追加コストなしで対応可能。",
    tags: ["セキュリティ", "2FA", "提案"],
  },

  // =====================
  // レポートカテゴリ（2件）
  // =====================
  {
    title: "月次レポート 2024年11月",
    category: "レポート",
    raw_content: `# 月次レポート - 2024年11月

## 1. サマリー

### 主要KPI
| 指標 | 10月 | 11月 | 増減 |
|------|------|------|------|
| MAU | 120 | 150 | +25% |
| 新規登録 | 45 | 62 | +38% |
| ドキュメント作成数 | 380 | 520 | +37% |
| AI要約利用率 | 72% | 78% | +6pt |

### ハイライト
- ベクトル検索機能をリリース
- PWA対応を完了
- 週次アクティブユーザーが過去最高を記録

## 2. 機能リリース

### 11/5: ベクトル検索
- pgvector を使った類似ドキュメント検索
- 検索精度が大幅に向上

### 11/15: PWA対応
- オフライン閲覧が可能に
- ホーム画面に追加可能

### 11/25: ダッシュボードUI改善
- サマリーカードの再設計
- 検索バーの強調

## 3. ユーザーフィードバック

### ポジティブ
- 「AI要約が便利」
- 「検索が早くなった」
- 「UIがきれい」

### ネガティブ
- 「チーム共有がしたい」
- 「ファイルサイズ制限が厳しい」
- 「タグの編集ができない」

## 4. 技術的な改善
- CI/CD パイプラインの高速化（3分→2分）
- テストカバレッジ: 65% → 72%
- Lighthouse スコア: 85 → 92

## 5. 来月の計画
- チームワークスペース機能の要件定義
- Sentry によるエラートラッキング導入
- パフォーマンス最適化`,
    summary:
      "2024年11月の月次レポート。MAU150人（+25%）、ドキュメント作成520件（+37%）と好調。ベクトル検索・PWA・UI改善をリリース。来月はチーム機能の要件定義とSentry導入を予定。",
    tags: ["レポート", "月次", "KPI"],
  },
  {
    title: "競合分析レポート 2024Q4",
    category: "レポート",
    raw_content: `# 競合分析レポート - 2024年Q4

## 1. 調査対象
- Notion
- Confluence
- Dropbox Paper
- Google Docs
- Coda

## 2. 機能比較

| 機能 | DocuFlow | Notion | Confluence |
|------|----------|--------|------------|
| AI要約 | ◎ | ○ | △ |
| ベクトル検索 | ○ | - | - |
| リアルタイム共同編集 | - | ◎ | ◎ |
| チーム管理 | - | ◎ | ◎ |
| オフライン対応 | ○ | ○ | △ |
| 日本語対応 | ◎ | ○ | ○ |

## 3. 価格比較

| サービス | 無料プラン | 有料プラン |
|----------|------------|------------|
| DocuFlow | あり（制限付き） | $9/月（予定）|
| Notion | あり | $8/月〜 |
| Confluence | 10ユーザーまで無料 | $5.75/月〜 |

## 4. 差別化ポイント

### DocuFlow の強み
1. **AI要約に特化**: 他社より高精度
2. **ベクトル検索**: 類似ドキュメント検索
3. **シンプルなUI**: 機能を絞って使いやすく
4. **日本語最適化**: プロンプトが日本語に特化

### 弱み
1. チーム機能がない（開発中）
2. リアルタイム共同編集がない
3. ブランド認知度が低い

## 5. 戦略提言

### 短期（3ヶ月）
- チーム機能でNotionに近づく
- 日本語AI要約の精度をさらに強化

### 中期（6ヶ月）
- エンタープライズ向け機能
- API提供で他サービス連携

### 長期（1年）
- 独自LLMの検討
- 海外展開`,
    summary:
      "Q4競合分析レポート。Notion/Confluence/Dropbox Paper等と比較。DocuFlowの強みはAI要約特化・ベクトル検索・日本語最適化。弱みはチーム機能不足。短期でチーム機能、中期でエンタープライズ対応を提言。",
    tags: ["競合分析", "戦略", "レポート"],
  },

  // =====================
  // マニュアル/ガイド（2件）
  // =====================
  {
    title: "新メンバー向け オンボーディングガイド",
    category: "マニュアル",
    raw_content: `# 新メンバー向け オンボーディングガイド

ようこそ DocuFlow チームへ！
このガイドでは、開発環境のセットアップから最初のコントリビューションまでを説明します。

## 1. 必要なツール

### 必須
- Node.js 18以上
- Git
- VS Code（推奨エディタ）
- Cursor（AI補完）

### オプション
- Docker（ローカルSupabase用）
- Postman（API テスト）

## 2. 環境セットアップ

### 2.1 リポジトリのクローン
\`\`\`bash
git clone https://github.com/your-org/docuflow.git
cd docuflow
npm install
\`\`\`

### 2.2 環境変数の設定
\`\`\`bash
cp .env.example .env.local
# .env.local を編集して各種キーを設定
\`\`\`

### 2.3 開発サーバーの起動
\`\`\`bash
npm run dev
# http://localhost:3000 でアクセス
\`\`\`

## 3. プロジェクト構成

\`\`\`
docuflow/
├── app/           # Next.js App Router
├── components/    # 再利用可能コンポーネント
├── lib/           # ユーティリティ・API
├── tests/         # ユニットテスト
├── e2e/           # E2Eテスト
├── docs/          # ドキュメント
└── supabase/      # マイグレーション
\`\`\`

## 4. 開発フロー

1. Issue を確認またはトリアージ
2. feature ブランチを作成
3. 実装・テスト
4. PR を作成
5. レビュー後マージ

## 5. コーディング規約
- ESLint + Prettier に従う
- コミットメッセージは Conventional Commits
- テストカバレッジ 70%以上を維持

## 6. 困ったときは
- Slack #dev-help チャンネル
- GitHub Discussions
- 1on1 でメンターに相談`,
    summary:
      "新メンバー向けオンボーディングガイド。必要ツール（Node.js/Git/VS Code）、環境セットアップ手順、プロジェクト構成、開発フロー（Issue→PR→レビュー）、コーディング規約を説明。",
    tags: ["オンボーディング", "ガイド", "開発"],
  },
  {
    title: "トラブルシューティングガイド",
    category: "マニュアル",
    raw_content: `# トラブルシューティングガイド

よくある問題と解決方法をまとめています。

## 1. 開発環境

### npm install が失敗する
\`\`\`bash
# node_modules を削除して再インストール
rm -rf node_modules package-lock.json
npm install
\`\`\`

### 開発サーバーが起動しない
- ポート3000が使用中: \`lsof -i :3000\` で確認
- 環境変数の設定漏れ: \`.env.local\` を確認

### ビルドが失敗する
\`\`\`bash
# .next キャッシュをクリア
rm -rf .next
npm run build
\`\`\`

## 2. 認証関連

### ログインできない
- Supabase ダッシュボードでユーザーの状態を確認
- Cookie が正しく設定されているか確認
- ブラウザのシークレットモードで試す

### パスワードリセットメールが届かない
- スパムフォルダを確認
- Supabase の SMTP 設定を確認
- Supabase ダッシュボードでメール送信ログを確認

## 3. AI関連

### AI要約が生成されない
- OpenAI API キーが有効か確認
- API レート制限に達していないか確認
- ネットワークエラーがないか確認

### 要約の精度が悪い
- 入力テキストが短すぎないか確認
- 日本語以外が混在していないか確認

## 4. データベース

### Supabase に接続できない
- 環境変数の URL/KEY を確認
- Supabase のステータスページを確認
- VPN/ファイアウォールの影響を確認

### RLS でデータが取得できない
- ログインしているか確認
- user_id が正しく設定されているか確認
- ポリシーの条件を確認

## 5. デプロイ

### Vercel デプロイが失敗する
- ビルドログでエラーを確認
- 環境変数が設定されているか確認
- \`next.config.ts\` の設定を確認

### 本番でエラーが発生する
- Sentry でエラー詳細を確認
- Vercel Function Logs を確認
- 環境変数の Production 設定を確認`,
    summary:
      "開発・認証・AI・データベース・デプロイに関するトラブルシューティングガイド。npm install失敗、ログイン問題、AI要約エラー、Supabase接続問題、Vercelデプロイ失敗の解決方法を網羅。",
    tags: ["トラブルシューティング", "ガイド", "FAQ"],
  },
];

async function seedDocuments() {
  console.log("🌱 デモ用ドキュメントの登録を開始します...\n");

  let successCount = 0;
  let errorCount = 0;

  for (const doc of sampleDocuments) {
    const { error } = await supabase.from("documents").insert({
      user_id: DEMO_USER_ID,
      title: doc.title,
      category: doc.category,
      raw_content: doc.raw_content,
      summary: doc.summary,
      tags: doc.tags,
      is_favorite: Math.random() > 0.7, // 30%の確率でお気に入り
      is_pinned: Math.random() > 0.85, // 15%の確率でピン留め
      is_archived: false,
    });

    if (error) {
      console.error(`❌ エラー: ${doc.title}`);
      console.error(`   ${error.message}`);
      errorCount++;
    } else {
      console.log(`✅ 登録完了: ${doc.title} [${doc.category}]`);
      successCount++;
    }
  }

  console.log("\n========================================");
  console.log(`📊 結果: 成功 ${successCount} 件 / 失敗 ${errorCount} 件`);
  console.log("========================================\n");

  if (successCount > 0) {
    console.log("💡 次のステップ:");
    console.log("   1. https://docuflow-azure.vercel.app にアクセス");
    console.log("   2. デモユーザーでログイン");
    console.log("   3. ダッシュボードでドキュメントを確認");
    console.log("   4. 検索・フィルタ・AI類似検索を試す\n");
  }
}

// 実行
seedDocuments().catch(console.error);

