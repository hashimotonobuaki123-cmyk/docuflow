/**
 * デモ用サンプルドキュメント投入スクリプト
 *
 * 使い方:
 * 1. .env に SUPABASE_URL, SUPABASE_SERVICE_ROLE_KEY を設定
 * 2. npx tsx scripts/seed-demo-data.ts
 *
 * 注意: 本番環境では実行しないでください
 */

import { createClient } from "@supabase/supabase-js";
import OpenAI from "openai";

// 環境変数から設定を読み込み
const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL;
const supabaseServiceKey = process.env.SUPABASE_SERVICE_ROLE_KEY;
const openaiKey = process.env.OPENAI_API_KEY;

if (!supabaseUrl || !supabaseServiceKey) {
  console.error("❌ SUPABASE_URL と SUPABASE_SERVICE_ROLE_KEY を設定してください");
  process.exit(1);
}

const supabase = createClient(supabaseUrl, supabaseServiceKey);
const openai = openaiKey ? new OpenAI({ apiKey: openaiKey }) : null;

// デモユーザーID（実際のユーザーIDに置き換えてください）
const DEMO_USER_ID = process.env.DEMO_USER_ID || null;

// サンプルドキュメントデータ
const sampleDocuments = [
  // ========== 仕様書 ==========
  {
    title: "API設計仕様書 - ユーザー認証エンドポイント",
    category: "仕様書",
    raw_content: `# ユーザー認証API仕様書

## 概要
本ドキュメントでは、ユーザー認証に関するRESTful APIエンドポイントの仕様を定義します。

## エンドポイント一覧

### POST /api/auth/login
ユーザーログインを行います。

**リクエストボディ:**
\`\`\`json
{
  "email": "user@example.com",
  "password": "********"
}
\`\`\`

**レスポンス (200 OK):**
\`\`\`json
{
  "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "refreshToken": "dGhpcyBpcyBhIHJlZnJlc2ggdG9rZW4...",
  "expiresIn": 3600
}
\`\`\`

### POST /api/auth/refresh
アクセストークンを更新します。

### POST /api/auth/logout
ユーザーログアウトを行い、リフレッシュトークンを無効化します。

## セキュリティ要件
- パスワードはbcryptでハッシュ化
- JWTの有効期限は1時間
- リフレッシュトークンは30日間有効
- レート制限: 10リクエスト/分`,
  },
  {
    title: "データベース設計書 - Eコマース注文管理システム",
    category: "仕様書",
    raw_content: `# Eコマース注文管理システム データベース設計書

## 1. テーブル一覧

### orders テーブル
| カラム名 | 型 | 説明 |
|---------|-----|------|
| id | UUID | 注文ID |
| user_id | UUID | 購入者ID |
| total_amount | DECIMAL | 合計金額 |
| status | ENUM | 注文状態 (pending/confirmed/shipped/delivered/cancelled) |
| created_at | TIMESTAMP | 注文日時 |

### order_items テーブル
| カラム名 | 型 | 説明 |
|---------|-----|------|
| id | UUID | 明細ID |
| order_id | UUID | 注文ID (FK) |
| product_id | UUID | 商品ID |
| quantity | INT | 数量 |
| unit_price | DECIMAL | 単価 |

### products テーブル
| カラム名 | 型 | 説明 |
|---------|-----|------|
| id | UUID | 商品ID |
| name | VARCHAR | 商品名 |
| price | DECIMAL | 価格 |
| stock | INT | 在庫数 |
| category_id | UUID | カテゴリID |

## 2. インデックス設計
- orders: user_id, status, created_at
- order_items: order_id, product_id
- products: category_id, name

## 3. 外部キー制約
- order_items.order_id → orders.id (CASCADE DELETE)
- order_items.product_id → products.id (RESTRICT)`,
  },
  {
    title: "画面設計仕様書 - ダッシュボード画面",
    category: "仕様書",
    raw_content: `# ダッシュボード画面設計仕様書

## 画面概要
ユーザーがログイン後に最初に表示されるダッシュボード画面の設計です。

## 画面構成

### ヘッダー領域
- ロゴ（左上）
- 検索バー（中央）
- ユーザーメニュー（右上）
  - プロフィール写真
  - 通知アイコン（未読バッジ付き）
  - 設定ドロップダウン

### メインコンテンツ

#### サマリーカード（4列）
1. 総売上（今月）: ¥12,345,678 / 前月比 +12%
2. 新規顧客数: 234名 / 前月比 +8%
3. 注文件数: 1,234件 / 前月比 +15%
4. 平均単価: ¥10,234 / 前月比 -2%

#### グラフエリア（2列）
- 左: 売上推移（折れ線グラフ、過去6ヶ月）
- 右: カテゴリ別売上（円グラフ）

#### 最近のアクティビティ（リスト）
- 直近10件の注文・更新を時系列表示
- クリックで詳細画面に遷移

## レスポンシブ対応
- デスクトップ: 4列 → 2列 → 1列
- タブレット: 2列表示
- モバイル: 1列表示、グラフは横スクロール`,
  },

  // ========== 議事録 ==========
  {
    title: "週次定例MTG議事録 - 2024年12月第1週",
    category: "議事録",
    raw_content: `# 週次定例MTG議事録

**日時:** 2024年12月2日（月）10:00-11:00
**参加者:** 山田（PM）、佐藤（開発）、田中（デザイン）、鈴木（QA）
**場所:** オンライン（Google Meet）

## アジェンダ

### 1. 先週の進捗報告

#### 開発チーム（佐藤）
- ユーザー認証機能: 完了 ✅
- ダッシュボードAPI: 80%完了
- 課題: テストカバレッジが目標の70%に未達（現在55%）

#### デザインチーム（田中）
- ダッシュボードUI: Figmaで確定済み
- モバイル対応デザイン: 作業中
- 来週中に全画面のデザイン完了予定

#### QAチーム（鈴木）
- テスト計画書: ドラフト完成
- 自動テスト環境: セットアップ完了

### 2. 今週のタスク
- [ ] ダッシュボードAPI完成（佐藤）
- [ ] テストカバレッジ70%達成（佐藤）
- [ ] モバイルデザイン完成（田中）
- [ ] 結合テスト開始（鈴木）

### 3. ブロッカー・リスク
- 外部API連携でレート制限の懸念 → 対策検討中
- デザインレビューが遅れると開発に影響

### 4. 次回予定
- 12月9日（月）10:00〜
- アジェンダ: スプリントレビュー、リリース計画`,
  },
  {
    title: "プロジェクトキックオフMTG議事録",
    category: "議事録",
    raw_content: `# プロジェクトキックオフMTG議事録

**プロジェクト名:** 顧客管理システムリニューアル（CRM 2.0）
**日時:** 2024年11月15日（金）14:00-16:00
**参加者:** 全プロジェクトメンバー（12名）

## 1. プロジェクト概要

### 背景
- 現行CRMは5年前に導入、UIが古く操作性に課題
- モバイル対応が不十分で営業からの不満多数
- データ分析機能が弱く、経営判断に活用できていない

### 目的
1. モダンなUI/UXで業務効率を30%向上
2. モバイルファーストで外出先でも利用可能に
3. AI分析機能で売上予測・顧客行動分析を実現

### スコープ
- 顧客情報管理
- 商談管理
- 活動履歴
- レポート・ダッシュボード
- モバイルアプリ（iOS/Android）

## 2. スケジュール

| フェーズ | 期間 | 主な成果物 |
|---------|------|-----------|
| 要件定義 | 11月〜12月 | 要件定義書、画面設計書 |
| 設計 | 1月〜2月 | 基本設計書、詳細設計書 |
| 開発 | 3月〜6月 | プログラム、単体テスト |
| テスト | 7月〜8月 | 結合テスト、UAT |
| リリース | 9月 | 本番移行、運用開始 |

## 3. 体制
- PM: 山田
- 開発リード: 佐藤
- インフラ: 高橋
- QA: 鈴木

## 4. 次のアクション
- 要件ヒアリング日程調整（山田）
- 現行システム分析（佐藤）
- インフラ要件整理（高橋）`,
  },
  {
    title: "デザインレビュー会議議事録",
    category: "議事録",
    raw_content: `# デザインレビュー会議議事録

**日時:** 2024年11月28日（木）15:00-16:30
**参加者:** 田中（デザイン）、佐藤（開発）、山田（PM）、営業部 伊藤
**議題:** 新ダッシュボードデザインのレビュー

## レビュー対象
Figmaリンク: https://figma.com/xxxxx

## フィードバック一覧

### 1. サマリーカード
**現状:** 4つのKPIカードを横並び
**フィードバック:**
- 伊藤: 数字が小さくて見づらい。特にモバイルで。
- 山田: 前月比の矢印の色分けは良い。
**対応:** フォントサイズを14px→16pxに変更、モバイルは2×2グリッドに

### 2. グラフエリア
**現状:** 折れ線グラフと円グラフを横並び
**フィードバック:**
- 佐藤: グラフのホバー時にツールチップが欲しい
- 伊藤: 期間選択（週/月/年）を追加してほしい
**対応:** ツールチップ追加、期間セレクタを右上に配置

### 3. カラーパレット
**現状:** ブルー系メイン
**フィードバック:**
- 田中: アクセシビリティ（コントラスト比）を再確認したい
- 山田: 企業カラーのグリーンをアクセントに使えないか
**対応:** AA基準のコントラスト確保、CTAボタンにグリーン採用

## 決定事項
1. 上記フィードバックを反映した修正版を12/2までに作成
2. 12/3に最終承認MTGを開催
3. 承認後、開発チームにハンドオフ

## 次回予定
- 12月3日（火）14:00〜 最終デザイン承認`,
  },

  // ========== 企画書 ==========
  {
    title: "新機能企画書 - AIチャットボット導入",
    category: "企画書",
    raw_content: `# AIチャットボット導入 企画書

## 1. 企画概要

### 背景
- カスタマーサポートへの問い合わせが月間3,000件を超過
- 平均応答時間が24時間以上で顧客満足度が低下
- サポートスタッフの負担増大、離職率上昇

### 目的
AIチャットボットを導入し、簡単な問い合わせを自動応答することで：
1. 平均応答時間を2時間以内に短縮
2. サポートスタッフの負担を50%軽減
3. 顧客満足度を20%向上

## 2. 機能要件

### 基本機能
- FAQ自動応答（よくある質問100件に対応）
- 注文状況照会
- 返品・交換手続きガイド
- 営業時間・店舗案内

### 高度な機能
- 自然言語理解による意図推定
- 有人オペレーターへのエスカレーション
- 会話履歴の分析・レポート
- 多言語対応（日本語・英語・中国語）

## 3. 技術選定

| 項目 | 選定技術 | 理由 |
|------|---------|------|
| LLM | OpenAI GPT-4 | 日本語精度が高い |
| チャットUI | Intercom | 既存導入済み |
| ナレッジベース | Notion API連携 | FAQ管理の効率化 |

## 4. 予算・スケジュール

### 概算予算
- 初期開発: 500万円
- 月額運用: 30万円（API費用含む）

### スケジュール
- 1月: 要件定義・設計
- 2月: 開発・FAQデータ整備
- 3月: テスト・チューニング
- 4月: 本番リリース

## 5. KPI
- 自動応答率: 60%以上
- 顧客満足度: 4.0/5.0以上
- 平均応答時間: 2時間以内`,
  },
  {
    title: "マーケティングキャンペーン企画書 - 年末セール",
    category: "企画書",
    raw_content: `# 年末セール マーケティングキャンペーン企画書

## 1. キャンペーン概要

**キャンペーン名:** 年末大感謝祭セール 2024
**期間:** 2024年12月20日〜12月31日（12日間）
**目標:** 売上前年比120%、新規会員獲得5,000名

## 2. ターゲット

### メインターゲット
- 既存会員（過去1年以内に購入履歴あり）
- 年齢: 25〜45歳
- 年末のギフト需要、自分へのご褒美需要

### サブターゲット
- 休眠会員（1年以上購入なし）の掘り起こし
- SNS経由の新規顧客

## 3. キャンペーン内容

### 割引施策
| 期間 | 内容 | 対象 |
|------|------|------|
| 12/20-22 | 先行セール 20%OFF | プレミアム会員限定 |
| 12/23-25 | クリスマス特別 30%OFF | 全会員 |
| 12/26-31 | 最終セール 最大50%OFF | 全顧客 |

### 特典
- 1万円以上購入でオリジナルノベルティプレゼント
- 新規会員登録で500ポイント進呈
- まとめ買い割引（3点以上で追加5%OFF）

## 4. プロモーション計画

### デジタル
- メールマガジン: 12/15, 12/20, 12/25, 12/28 配信
- LINE公式: 毎日プッシュ通知
- Instagram/X: インフルエンサー5名とコラボ
- リターゲティング広告: Google/Meta

### オフライン
- 店頭POP・ポスター
- 新聞折込チラシ（12/18）

## 5. 予算

| 項目 | 予算 |
|------|------|
| 広告費 | 300万円 |
| インフルエンサー費 | 100万円 |
| ノベルティ制作 | 50万円 |
| 印刷物 | 30万円 |
| **合計** | **480万円** |

## 6. 効果測定
- 日次売上モニタリング
- 流入経路別CVR分析
- SNSエンゲージメント計測`,
  },

  // ========== 提案書 ==========
  {
    title: "システムリプレイス提案書",
    category: "提案書",
    raw_content: `# 基幹システムリプレイス提案書

**提案先:** 株式会社〇〇様
**提案日:** 2024年11月25日
**提案者:** 株式会社テックソリューションズ

## 1. ご提案の背景

### 現状の課題（ヒアリング結果）
1. **システムの老朽化**
   - 導入から10年経過、保守コストが年々増加
   - ベンダーのサポート終了が2026年に迫る

2. **業務効率の低下**
   - 画面遷移が多く、1処理に平均5分以上
   - 部門間でのデータ連携が手作業

3. **データ活用の限界**
   - リアルタイムでの在庫把握ができない
   - 経営ダッシュボードが存在しない

## 2. ご提案内容

### 2.1 システム概要
クラウドネイティブな次世代ERPシステムへの移行

**主要機能:**
- 販売管理
- 購買管理
- 在庫管理
- 会計連携
- 経営ダッシュボード

### 2.2 技術アーキテクチャ
- クラウド: AWS (東京リージョン)
- バックエンド: Node.js + PostgreSQL
- フロントエンド: React
- モバイル: React Native

### 2.3 導入効果（想定）
| 項目 | 現状 | 導入後 | 改善率 |
|------|------|--------|--------|
| 処理時間/件 | 5分 | 2分 | 60%削減 |
| 月次決算 | 10日 | 3日 | 70%短縮 |
| 保守コスト | 年2,000万 | 年800万 | 60%削減 |

## 3. スケジュール・費用

### スケジュール
- フェーズ1（6ヶ月）: 要件定義〜基本設計
- フェーズ2（8ヶ月）: 詳細設計〜開発
- フェーズ3（4ヶ月）: テスト〜移行

### 概算費用
- 初期費用: 8,000万円
- 年間運用費: 800万円

## 4. 弊社の強み
- 同業種での導入実績10社以上
- 24時間365日の運用サポート体制
- 段階的移行によるリスク最小化`,
  },
  {
    title: "業務効率化ツール導入提案書",
    category: "提案書",
    raw_content: `# 業務効率化ツール導入提案書

**対象部門:** 営業部・マーケティング部
**提案日:** 2024年12月1日

## 1. 現状分析

### 課題
1. **営業部**
   - 顧客情報がExcelで個人管理、共有されていない
   - 日報作成に毎日30分以上かかる
   - 案件の進捗が可視化されていない

2. **マーケティング部**
   - リード情報が複数システムに分散
   - キャンペーン効果測定が手作業
   - 営業への引き渡しがスムーズでない

## 2. 提案ツール

### Salesforce Sales Cloud + Marketing Cloud

**選定理由:**
- CRMとMAが統合され、データがシームレスに連携
- 日本語サポートが充実
- カスタマイズ性が高く、既存業務に合わせられる

## 3. 導入効果

### 営業部
| 業務 | Before | After | 効果 |
|------|--------|-------|------|
| 顧客情報検索 | 10分 | 30秒 | 95%削減 |
| 日報作成 | 30分 | 5分 | 83%削減 |
| 案件確認 | 都度問い合わせ | リアルタイム | - |

### マーケティング部
| 業務 | Before | After | 効果 |
|------|--------|-------|------|
| リード管理 | 手動集計 | 自動 | 工数ゼロ |
| 効果測定 | 2日 | リアルタイム | 即時 |
| 営業連携 | メール | 自動通知 | 即時 |

## 4. 費用・スケジュール

### 初期費用
- ライセンス: 月額15万円 × 50ユーザー
- 初期設定・カスタマイズ: 300万円
- トレーニング: 50万円

### スケジュール
- 1月: 要件定義・設計
- 2月: 環境構築・データ移行
- 3月: トレーニング・並行運用
- 4月: 本番稼働

## 5. 成功のポイント
- 経営層のコミットメント
- 現場キーマンの巻き込み
- 段階的な機能展開`,
  },

  // ========== レポート ==========
  {
    title: "月次売上レポート - 2024年11月",
    category: "レポート",
    raw_content: `# 月次売上レポート - 2024年11月

## エグゼクティブサマリー

**総売上:** 1億2,345万円（前年同月比 +8.5%）
**営業利益:** 2,469万円（利益率 20%）
**新規顧客数:** 234社（前月比 +12%）

### ハイライト
✅ EC売上が前年比30%増で過去最高を更新
✅ 新規大口顧客3社を獲得（合計受注額5,000万円）
⚠️ 原材料費高騰により粗利率が2%低下

---

## 1. 売上詳細

### チャネル別売上
| チャネル | 売上 | 構成比 | 前年比 |
|---------|------|--------|--------|
| 直販 | 6,000万円 | 48.6% | +5% |
| EC | 4,000万円 | 32.4% | +30% |
| 代理店 | 2,345万円 | 19.0% | -5% |

### 商品カテゴリ別
| カテゴリ | 売上 | 構成比 |
|---------|------|--------|
| 主力製品A | 5,000万円 | 40.5% |
| 新製品B | 3,500万円 | 28.4% |
| サービス | 2,345万円 | 19.0% |
| その他 | 1,500万円 | 12.1% |

## 2. 顧客分析

### 顧客セグメント別
- エンタープライズ: 45社（売上8,000万円）
- SMB: 189社（売上4,345万円）

### 解約率
- 月次解約率: 1.2%（目標2%以下 ✅）
- 主な解約理由: 予算削減、競合乗り換え

## 3. 来月の見通し

### 12月売上予測: 1億5,000万円
- 年末商戦による需要増
- 大口案件2件のクロージング予定
- EC向けセールキャンペーン実施

### リスク要因
- 競合の価格攻勢
- 為替変動（円安による仕入コスト増）`,
  },
  {
    title: "ユーザー調査レポート - アプリUX改善",
    category: "レポート",
    raw_content: `# ユーザー調査レポート - アプリUX改善

**調査期間:** 2024年11月1日〜15日
**調査方法:** オンラインアンケート + ユーザーインタビュー
**回答数:** アンケート 500名、インタビュー 12名

---

## 1. 調査目的

モバイルアプリのUX改善に向けて、以下を明らかにする：
1. 現状の使いにくいポイント
2. ユーザーが求めている機能
3. 競合アプリとの比較評価

## 2. 主要な発見

### 2.1 満足度スコア
- 総合満足度: 3.2 / 5.0
- 使いやすさ: 2.8 / 5.0 ⚠️
- 機能の充実度: 3.5 / 5.0
- デザイン: 3.8 / 5.0

### 2.2 不満点TOP5
1. **検索機能が弱い**（68%が指摘）
   - 「キーワードで見つからない」
   - 「フィルタ条件が少ない」

2. **読み込みが遅い**（54%が指摘）
   - 「画像が多い画面で止まる」
   - 「電波が悪いと使えない」

3. **通知が多すぎる**（42%が指摘）
   - 「細かく設定できない」
   - 「重要でない通知が多い」

4. **ナビゲーションが分かりにくい**（38%が指摘）
   - 「目的の画面にたどり着けない」
   - 「戻るボタンの挙動が不自然」

5. **オフラインで使えない**（31%が指摘）
   - 「地下鉄で使いたい」

### 2.3 要望TOP3
1. ダークモード対応
2. ウィジェット機能
3. Apple Watch対応

## 3. 競合比較

| 項目 | 自社 | A社 | B社 |
|------|------|------|------|
| 検索精度 | △ | ◎ | ○ |
| 速度 | △ | ○ | ◎ |
| UI/UX | ○ | ◎ | ○ |
| 機能数 | ◎ | ○ | △ |

## 4. 改善提案

### 優先度高
1. 検索機能の強化（AI検索導入）
2. パフォーマンス最適化
3. 通知設定の細分化

### 優先度中
4. ナビゲーション再設計
5. オフラインモード実装

### 優先度低
6. ダークモード
7. ウィジェット`,
  },
  {
    title: "競合分析レポート - SaaS市場動向",
    category: "レポート",
    raw_content: `# 競合分析レポート - SaaS市場動向 2024

**作成日:** 2024年11月20日
**対象市場:** 国内BtoB SaaS（業務効率化領域）

---

## 1. 市場概況

### 市場規模
- 2024年: 1兆2,000億円（前年比 +15%）
- 2027年予測: 2兆円（CAGR 18%）

### 成長ドライバー
1. DX推進の加速
2. リモートワークの定着
3. 中小企業のクラウド移行

## 2. 競合マッピング

### ポジショニングマップ

```
        高機能
           ↑
      [A社]  [自社]
           |
  低価格 ←―+―→ 高価格
           |
      [C社]  [B社]
           ↓
        シンプル
```

## 3. 主要競合分析

### A社（市場シェア1位・25%）
**強み:**
- 圧倒的なブランド認知度
- 豊富な連携サービス
- 手厚いカスタマーサクセス

**弱み:**
- 価格が高い（月額2万円〜）
- カスタマイズに時間がかかる

**最近の動き:**
- AI機能を大幅強化（11月リリース）
- エンタープライズ向け新プラン発表

### B社（市場シェア2位・18%）
**強み:**
- エンタープライズに強い
- セキュリティ認証が充実

**弱み:**
- UIが古い
- 中小企業には機能過多

### C社（急成長中・シェア8%）
**強み:**
- 低価格（月額5,000円〜）
- シンプルで使いやすい
- スタートアップに人気

**弱み:**
- 機能が限定的
- サポートが薄い

## 4. 自社の競争優位性

### 強み
1. 価格と機能のバランスが良い
2. 日本企業の業務フローに最適化
3. 手厚い導入支援

### 課題
1. 認知度がまだ低い
2. エンタープライズ向け機能が不足
3. 海外展開ができていない

## 5. 戦略提言

### 短期（6ヶ月）
- AI機能の強化で A社に対抗
- マーケティング投資を1.5倍に

### 中期（1年）
- エンタープライズ機能の拡充
- パートナー戦略の強化

### 長期（3年）
- アジア市場への展開
- M&Aによる機能拡張`,
  },

  // ========== マニュアル ==========
  {
    title: "新入社員向けオンボーディングマニュアル",
    category: "マニュアル",
    raw_content: `# 新入社員向けオンボーディングマニュアル

ようこそ！このマニュアルでは、入社後の手続きと最初の1ヶ月の流れを説明します。

---

## 📋 入社初日にやること

### 1. 人事手続き
- [ ] 入社書類の提出（人事部 受付）
- [ ] 社員証の受け取り
- [ ] 銀行口座届出書の提出

### 2. IT関連のセットアップ
- [ ] PCの受け取り（IT部 3F）
- [ ] メールアカウントの設定
- [ ] Slackへの参加
- [ ] 社内システムへのログイン確認

### 3. オリエンテーション
- 10:00〜12:00: 会社説明（会議室A）
- 13:00〜14:00: 部門紹介
- 14:00〜15:00: セキュリティ研修
- 15:00〜16:00: コンプライアンス研修

---

## 🖥 使用するツール一覧

| ツール | 用途 | ログイン方法 |
|--------|------|--------------|
| Gmail | メール | SSO |
| Slack | チャット | SSO |
| Notion | ドキュメント | SSO |
| Jira | タスク管理 | SSO |
| GitHub | ソースコード | 個別アカウント |

### SSO（シングルサインオン）とは？
会社のGoogleアカウントでログインすれば、連携ツールに自動でログインできます。

---

## 📅 最初の1ヶ月のスケジュール

### Week 1: インプット週間
- 会社・部門の理解
- 製品・サービスの学習
- 先輩社員との1on1

### Week 2: OJT開始
- 実際の業務を見学
- 簡単なタスクを担当
- 日報を毎日提出

### Week 3-4: 実践
- 担当業務を開始
- メンターとの定期MTG
- 1ヶ月目標の振り返り

---

## ❓ よくある質問

**Q: 休暇はいつから取れますか？**
A: 入社6ヶ月後に10日付与されます。

**Q: リモートワークはできますか？**
A: 試用期間終了後、週2日まで可能です。

**Q: 困ったときは誰に聞けばいいですか？**
A: まずはメンターに相談してください。Slackの #help チャンネルも活用できます。

---

## 📞 連絡先

- 人事部: hr@example.com
- IT部: it-support@example.com
- 総務部: general@example.com`,
  },
  {
    title: "Slack運用ガイドライン",
    category: "マニュアル",
    raw_content: `# Slack運用ガイドライン

社内コミュニケーションツール「Slack」の運用ルールです。

---

## 🎯 基本方針

1. **オープンなコミュニケーション** - DMより公開チャンネルを優先
2. **非同期コミュニケーション** - 即レス不要、自分のペースで
3. **検索しやすい情報共有** - 後から見返せる形で

---

## 📢 チャンネル構成

### 全社チャンネル
| チャンネル | 用途 | 投稿者 |
|-----------|------|--------|
| #general | 全社アナウンス | 管理部門のみ |
| #random | 雑談・交流 | 誰でも |
| #help | 困りごと相談 | 誰でも |

### 部門チャンネル
- #sales - 営業部
- #marketing - マーケ部
- #engineering - 開発部
- #design - デザイン部

### プロジェクトチャンネル
- #proj-xxx - プロジェクト単位で作成
- 命名規則: #proj-[プロジェクト名]
- 完了後はアーカイブ

---

## 💬 投稿のマナー

### やってほしいこと ✅
- メンションは必要な人だけに
- 長文はスレッドで返信
- 絵文字リアクションで既読を示す
- コードは \`\`\` で囲む

### 避けてほしいこと ❌
- @channel の乱用（緊急時のみ）
- 業務時間外の緊急でないメンション
- 機密情報の投稿（顧客情報、パスワード等）

---

## 🔔 通知設定のおすすめ

### 集中したいとき
1. ステータスを「集中モード」に
2. 通知を「DMとメンションのみ」に

### 設定方法
環境設定 → 通知 → 通知のタイミング

---

## 🤖 便利なbot・連携

### /remind
\`\`\`
/remind me to 週報提出 every Friday at 17:00
\`\`\`

### /poll
\`\`\`
/poll "ランチどこ行く？" "ラーメン" "カレー" "定食"
\`\`\`

### 外部連携
- Google Calendar: 予定をSlackに通知
- GitHub: PR/Issueの通知
- Jira: チケット更新の通知

---

## 🚨 緊急時の対応

### 緊急連絡が必要な場合
1. #emergency チャンネルに投稿
2. @channel で全員に通知
3. 電話でも連絡（連絡網参照）

### 対応完了したら
- スレッドで経過報告
- 🎉 リアクションでクローズを示す`,
  },
];

// AI 要約・タグ生成関数
async function generateSummaryAndTags(content: string) {
  if (!openai) {
    return { summary: content.slice(0, 200) + "...", tags: ["サンプル"] };
  }

  const prompt = `
あなたは日本語のドキュメントを整理するアシスタントです。
以下の本文を読み、次の形式の JSON を出力してください。

{
  "summary": "3〜5行の日本語要約",
  "tags": ["タグ1", "タグ2", "タグ3"]
}

本文:
---
${content.slice(0, 4000)}
---
`.trim();

  try {
    const response = await openai.chat.completions.create({
      model: "gpt-4.1-mini",
      messages: [
        {
          role: "system",
          content: "You are an assistant that summarizes Japanese documents and returns strict JSON.",
        },
        { role: "user", content: prompt },
      ],
      temperature: 0.2,
    });

    const text = response.choices[0]?.message?.content ?? "";
    const parsed = JSON.parse(text);
    return {
      summary: parsed.summary ?? "",
      tags: parsed.tags ?? [],
    };
  } catch (e) {
    console.error("AI生成エラー:", e);
    return { summary: content.slice(0, 200) + "...", tags: ["サンプル"] };
  }
}

// 埋め込みベクトル生成関数
async function generateEmbedding(text: string): Promise<number[] | null> {
  if (!openai) return null;

  try {
    const response = await openai.embeddings.create({
      model: "text-embedding-3-small",
      input: text.slice(0, 8000),
    });
    return response.data[0].embedding;
  } catch (e) {
    console.error("Embedding生成エラー:", e);
    return null;
  }
}

// メイン処理
async function main() {
  console.log("🚀 デモデータ投入を開始します...\n");

  for (let i = 0; i < sampleDocuments.length; i++) {
    const doc = sampleDocuments[i];
    console.log(`[${i + 1}/${sampleDocuments.length}] ${doc.title}`);

    // AI 要約・タグ生成
    console.log("  → AI要約生成中...");
    const { summary, tags } = await generateSummaryAndTags(doc.raw_content);

    // 埋め込みベクトル生成
    console.log("  → 埋め込みベクトル生成中...");
    const embedding = await generateEmbedding(doc.raw_content);

    // データ挿入
    const insertData: Record<string, unknown> = {
      user_id: DEMO_USER_ID,
      title: doc.title,
      category: doc.category,
      raw_content: doc.raw_content,
      summary,
      tags,
      is_favorite: Math.random() > 0.7, // 30%の確率でお気に入り
      is_pinned: Math.random() > 0.85, // 15%の確率でピン留め
      is_archived: false,
    };

    if (embedding) {
      insertData.embedding = embedding;
    }

    const { error } = await supabase.from("documents").insert(insertData);

    if (error) {
      console.error(`  ❌ エラー: ${error.message}`);
    } else {
      console.log(`  ✅ 完了 (タグ: ${tags.join(", ")})`);
    }

    // レート制限対策で少し待機
    await new Promise((resolve) => setTimeout(resolve, 1000));
  }

  console.log("\n🎉 デモデータの投入が完了しました！");
}

main().catch(console.error);

