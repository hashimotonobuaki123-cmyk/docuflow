## DocuFlow 画面一覧 & 画面遷移

### 1. 画面一覧

- **ルート / リダイレクト**
  - `/`
    - 説明: ルート。ログイン状態を見て `/app` もしくは `/auth/login` にリダイレクト。
    - コンポーネント: `app/page.tsx`

- **認証系**
  - `/auth/login`
    - 説明: メール & パスワードでのログイン画面。
    - 主な要素: ログインフォーム、サインアップ / パスワードリセットへのリンク。
  - `/auth/signup`
    - 説明: 新規アカウント作成フォーム。
  - `/auth/forgot`
    - 説明: パスワードリセットメール送信フォーム。
  - `/auth/reset`
    - 説明: メール内リンクから遷移するパスワード再設定フォーム。
  - `/auth/logout`
    - 説明: クッキーを削除してログアウトし、`/auth/login` へ遷移する中間画面。

- **メインアプリ**
  - `/app`
    - 説明: ログイン後のダッシュボード。検索フォーム・概要カード・ドキュメント一覧・最近のアクティビティを表示。
  - `/new`
    - 説明: 新規ドキュメント作成画面。テキスト入力と PDF / Word アップロードに対応。
  - `/documents/[id]`
    - 説明: ドキュメント詳細画面。AI 要約・本文・メタ情報・共有リンクの発行 / 停止・削除を行う。
  - `/documents/[id]/edit`
    - 説明: ドキュメント編集画面。保存時に AI による再要約とバージョン履歴の保存を行う。
  - `/share/[token]`
    - 説明: 共有リンクからアクセスする公開ビュー。要約と本文のみ閲覧可（編集不可）。
  - `/settings`
    - 説明: 設定画面。AI設定・共有リンク設定・ダッシュボード設定・アカウント削除セクションを含む。

### 2. 画面遷移フロー（テキスト版）

```text
未ログイン
  └─ アクセス: /
        └─ middleware / RootPage 経由で /auth/login へ

ログインフロー
  /auth/login
    ├─ ログイン成功 → クッキー設定 → /app へ遷移
    ├─ 「サインアップ」リンク → /auth/signup
    └─ 「パスワードをお忘れですか」 → /auth/forgot

パスワードリセット
  /auth/forgot
    └─ メール送信 → メール内リンク → /auth/reset
  /auth/reset
    └─ 新パスワード設定 → /auth/login へ

メインワークスペース
  /app
    ├─ 左サイドバー「新規作成」 → /new
    ├─ 左サイドバー「設定」 → /settings
    ├─ ドキュメントカードのタイトルクリック → /documents/[id]
    ├─ タグクリック → /app?q=<タグ名>
    └─ ヘッダーのユーザーメニューから「ログアウト」 → /auth/logout

新規ドキュメント作成
  /new
    ├─ フォーム送信成功 → `/app` へリダイレクト
    └─ ヘッダー「一覧に戻る」 → /app

ドキュメント詳細
  /documents/[id]
    ├─ 「編集」ボタン → /documents/[id]/edit
    ├─ 「共有リンクを発行」 → share_token 生成後、同じ画面で共有 URL 表示
    ├─ 「共有を停止」 → share_token null 更新
    ├─ 「削除」ボタン → confirm → `/app` へ
    └─ タグクリック → /app?q=<タグ名>

ドキュメント編集
  /documents/[id]/edit
    ├─ フォーム送信成功 → /documents/[id] に戻る
    └─ ヘッダー「詳細に戻る」 → /documents/[id]

共有ビュー
  /share/[token]
    ├─ middleware により認証ガードをスキップ
    └─ 閲覧専用（アクションなし）

設定
  /settings
    ├─ 「AI 設定」セクション
    │   ├─ 新規作成時の AI 要約デフォルト設定（チェックボックス）
    │   ├─ アップロード時の AI 要約デフォルト設定（チェックボックス）
    │   └─ 「変更を保存」ボタン → サーバーアクション → 同じ画面で反映
    ├─ 「共有リンク設定」セクション
    │   ├─ デフォルト有効期限の選択（7日 / 30日 / 無期限）
    │   └─ 「変更を保存」ボタン → サーバーアクション → 同じ画面で反映
    ├─ 「ダッシュボード設定」セクション
    │   ├─ デフォルト並び順の選択（新しい順 / 古い順 / ピン留め優先）
    │   ├─ アーカイブ表示のデフォルト設定（チェックボックス）
    │   ├─ 共有中のみ表示のデフォルト設定（チェックボックス）
    │   └─ 「変更を保存」ボタン → サーバーアクション → 同じ画面で反映
    └─ 「アカウント削除」セクション
        └─ 「アカウントを完全に削除する」 → confirm → サーバーアクション → /auth/logout?accountDeleted=1
```

### 3. 主要 UI コンポーネント

- **`Logo`**
  - 共通ロゴ。ヘッダーやサイドバーで使用。
- **`UserMenu`**
  - ヘッダー右側のユーザーメニュー。設定 / ログアウトへの導線。
- **`DeleteAccountSection`**
  - `/settings` に表示されるアカウント削除用 UI。ブラウザの confirm を挟み、サーバーアクションを呼び出す。
- **`AISettingsForm`**
  - `/settings` の AI 設定セクション。チェックボックスと保存ボタンを含む。
- **`ShareSettingsForm`**
  - `/settings` の共有リンク設定セクション。セレクトボックスと保存ボタンを含む。
- **`DashboardSettingsForm`**
  - `/settings` のダッシュボード設定セクション。セレクトボックス・チェックボックスと保存ボタンを含む。
